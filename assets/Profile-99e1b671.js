import{d as $,u as H,r as c,l as P,o as J,c as I,b as n,e as l,w as a,F as K,h as d,i as C,j as i,t as F,m as O,E as g,_ as Q}from"./index-e3d6c02a.js";const X={class:"profile-container"},Y={class:"profile-content"},Z={class:"profile-avatar"},ee={class:"avatar-wrapper"},le={class:"profile-form"},ae={key:0},re="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png",oe=$({__name:"Profile",setup(te){const h=H(),_=c(),b=c(),R=c(),U=c(!1),k=c(!1),y=c(!1),V=c(!1),r=P({username:"",email:"",avatar:"",gender:"",age:null,height:null,weight:null,healthGoal:"",phone:""}),p=P({currentPassword:"",newPassword:"",confirmPassword:""}),E=P({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],age:[{required:!1,type:"number",message:"请输入有效的年龄",trigger:"blur"}],height:[{required:!1,type:"number",message:"请输入有效的身高",trigger:"blur"}],weight:[{required:!1,type:"number",message:"请输入有效的体重",trigger:"blur"}]}),S=P({currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(t,e,f)=>{e!==p.newPassword?f(new Error("两次输入密码不一致")):f()},trigger:"blur"}]}),z=async()=>{_.value&&await _.value.validate(async t=>{if(t){U.value=!0;try{await h.updateProfile(r),g.success("资料保存成功")}catch(e){g.error("保存失败，请稍后重试"),console.error("Save profile error:",e)}finally{U.value=!1}}})},D=()=>{_.value&&(_.value.resetFields(),q())},M=()=>{b.value&&b.value.resetFields(),V.value=!0},N=async()=>{b.value&&await b.value.validate(async t=>{if(t){k.value=!0;try{await h.changePassword(p.currentPassword,p.newPassword),g.success("密码修改成功"),V.value=!1}catch(e){g.error("密码修改失败，请检查当前密码是否正确"),console.error("Change password error:",e)}finally{k.value=!1}}})},q=()=>{const t=h.user;t&&(r.username=t.username||"",r.email=t.email||"",r.avatar=t.avatar||"",r.gender=t.gender||"",r.age=t.age||null,r.height=t.height||null,r.weight=t.weight||null,r.healthGoal=t.healthGoal||"",r.phone=t.phone||"")},j=()=>{var t;(t=R.value)==null||t.click()},L=async t=>{var m;const e=t.target,f=(m=e.files)==null?void 0:m[0];if(f){if(!f.type.startsWith("image/")){g.error("请选择图片文件");return}if(f.size>5*1024*1024){g.error("图片大小不能超过5MB");return}y.value=!0;try{const u=new FileReader;u.onload=async s=>{var v;try{const w=(v=s.target)==null?void 0:v.result;r.avatar=w,await h.updateProfile({...r,avatar:w}),g.success("头像上传成功")}catch(w){g.error("头像上传失败，请稍后重试"),console.error("Upload avatar error:",w)}finally{y.value=!1,e&&(e.value="")}},u.readAsDataURL(f)}catch(u){g.error("头像上传失败，请稍后重试"),console.error("Upload avatar error:",u),y.value=!1}}};return J(()=>{q()}),(t,e)=>{const f=d("el-avatar"),m=d("el-button"),u=d("el-input"),s=d("el-form-item"),v=d("el-radio"),w=d("el-radio-group"),x=d("el-input-number"),A=d("el-form"),G=d("el-card"),B=d("el-descriptions-item"),T=d("el-descriptions"),W=d("el-dialog");return C(),I(K,null,[n("div",X,[l(G,{class:"profile-card"},{header:a(()=>[...e[12]||(e[12]=[n("div",{class:"profile-header"},[n("span",null,"个人资料")],-1)])]),default:a(()=>[n("div",Y,[n("div",Z,[n("div",ee,[l(f,{size:100,src:r.avatar||re,fit:"cover"},{default:a(()=>{var o;return[i(F(((o=t.user.username)==null?void 0:o.charAt(0))||"U"),1)]}),_:1},8,["src"]),e[13]||(e[13]=n("div",{class:"avatar-mask"},[n("i",{class:"el-icon-camera"})],-1)),n("input",{ref_key:"avatarInput",ref:R,type:"file",accept:"image/*",class:"avatar-input",onChange:L},null,544)]),l(m,{type:"primary",size:"small",class:"avatar-upload-btn",onClick:j,loading:y.value},{default:a(()=>[i(F(y.value?"上传中...":"更换头像"),1)]),_:1},8,["loading"])]),n("div",le,[l(A,{model:r,rules:E,ref_key:"profileFormRef",ref:_,"label-width":"100px"},{default:a(()=>[l(s,{label:"用户名",prop:"username"},{default:a(()=>[l(u,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=o=>r.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(s,{label:"邮箱",prop:"email"},{default:a(()=>[l(u,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=o=>r.email=o),placeholder:"请输入邮箱",disabled:""},null,8,["modelValue"])]),_:1}),l(s,{label:"性别",prop:"gender"},{default:a(()=>[l(w,{modelValue:r.gender,"onUpdate:modelValue":e[2]||(e[2]=o=>r.gender=o)},{default:a(()=>[l(v,{label:"male"},{default:a(()=>[...e[14]||(e[14]=[i("男",-1)])]),_:1}),l(v,{label:"female"},{default:a(()=>[...e[15]||(e[15]=[i("女",-1)])]),_:1}),l(v,{label:"other"},{default:a(()=>[...e[16]||(e[16]=[i("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"年龄",prop:"age"},{default:a(()=>[l(x,{modelValue:r.age,"onUpdate:modelValue":e[3]||(e[3]=o=>r.age=o),min:1,max:150,placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1}),l(s,{label:"身高(cm)",prop:"height"},{default:a(()=>[l(x,{modelValue:r.height,"onUpdate:modelValue":e[4]||(e[4]=o=>r.height=o),min:50,max:250,placeholder:"请输入身高"},null,8,["modelValue"])]),_:1}),l(s,{label:"体重(kg)",prop:"weight"},{default:a(()=>[l(x,{modelValue:r.weight,"onUpdate:modelValue":e[5]||(e[5]=o=>r.weight=o),min:10,max:300,placeholder:"请输入体重"},null,8,["modelValue"])]),_:1}),l(s,{label:"健康目标",prop:"healthGoal"},{default:a(()=>[l(u,{modelValue:r.healthGoal,"onUpdate:modelValue":e[6]||(e[6]=o=>r.healthGoal=o),type:"textarea",rows:2,placeholder:"请输入您的健康目标"},null,8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(m,{type:"primary",loading:U.value,onClick:z},{default:a(()=>[...e[17]||(e[17]=[i("保存资料",-1)])]),_:1},8,["loading"]),l(m,{onClick:D},{default:a(()=>[...e[18]||(e[18]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])])]),_:1}),l(G,{class:"security-card"},{header:a(()=>[...e[19]||(e[19]=[n("div",{class:"security-header"},[n("span",null,"账户安全")],-1)])]),default:a(()=>[l(T,{column:1,border:""},{default:a(()=>[l(B,{label:"修改密码"},{default:a(()=>[l(m,{type:"primary",onClick:M},{default:a(()=>[...e[20]||(e[20]=[i("修改密码",-1)])]),_:1})]),_:1}),l(B,{label:"绑定手机"},{default:a(()=>[r.phone?(C(),I("span",ae,"已绑定: "+F(r.phone),1)):(C(),O(m,{key:1,type:"primary"},{default:a(()=>[...e[21]||(e[21]=[i("绑定手机",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),l(W,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=o=>V.value=o),title:"修改密码",width:"400px"},{footer:a(()=>[l(m,{onClick:e[10]||(e[10]=o=>V.value=!1)},{default:a(()=>[...e[22]||(e[22]=[i("取消",-1)])]),_:1}),l(m,{type:"primary",loading:k.value,onClick:N},{default:a(()=>[...e[23]||(e[23]=[i("确认修改",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(A,{model:p,rules:S,ref_key:"passwordFormRef",ref:b,"label-width":"100px"},{default:a(()=>[l(s,{label:"当前密码",prop:"currentPassword"},{default:a(()=>[l(u,{modelValue:p.currentPassword,"onUpdate:modelValue":e[7]||(e[7]=o=>p.currentPassword=o),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),l(s,{label:"新密码",prop:"newPassword"},{default:a(()=>[l(u,{modelValue:p.newPassword,"onUpdate:modelValue":e[8]||(e[8]=o=>p.newPassword=o),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),l(s,{label:"确认新密码",prop:"confirmPassword"},{default:a(()=>[l(u,{modelValue:p.confirmPassword,"onUpdate:modelValue":e[9]||(e[9]=o=>p.confirmPassword=o),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});const ne=Q(oe,[["__scopeId","data-v-0b1bdc37"]]);export{ne as default};
