import{d as j,u as T,g as _,h as b,i as $,c as G,a as i,b as l,w as a,F as H,r as t,o as k,f as d,t as R,j as J,E as c,_ as K}from"./index-e13989ce.js";const L={class:"profile-container"},O={class:"profile-content"},Q={class:"profile-avatar"},W={class:"profile-form"},X={key:0},Y="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png",Z=j({__name:"Profile",setup(ee){const V=T(),f=_(),g=_(),y=_(!1),P=_(!1),w=_(!1),o=b({username:"",email:"",gender:"",age:null,height:null,weight:null,healthGoal:"",phone:""}),u=b({currentPassword:"",newPassword:"",confirmPassword:""}),B=b({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],age:[{required:!1,type:"number",message:"请输入有效的年龄",trigger:"blur"}],height:[{required:!1,type:"number",message:"请输入有效的身高",trigger:"blur"}],weight:[{required:!1,type:"number",message:"请输入有效的体重",trigger:"blur"}]}),E=b({currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(s,e,v)=>{e!==u.newPassword?v(new Error("两次输入密码不一致")):v()},trigger:"blur"}]}),S=async()=>{f.value&&await f.value.validate(async s=>{if(s){y.value=!0;try{await V.updateProfile(o),c.success("资料保存成功")}catch(e){c.error("保存失败，请稍后重试"),console.error("Save profile error:",e)}finally{y.value=!1}}})},I=()=>{f.value&&(f.value.resetFields(),x())},N=()=>{g.value&&g.value.resetFields(),w.value=!0},z=async()=>{g.value&&await g.value.validate(async s=>{if(s){P.value=!0;try{await V.changePassword(u.currentPassword,u.newPassword),c.success("密码修改成功"),w.value=!1}catch(e){c.error("密码修改失败，请检查当前密码是否正确"),console.error("Change password error:",e)}finally{P.value=!1}}})},x=()=>{const s=V.user;s&&(o.username=s.username||"",o.email=s.email||"",o.gender=s.gender||"",o.age=s.age||null,o.height=s.height||null,o.weight=s.weight||null,o.healthGoal=s.healthGoal||"",o.phone=s.phone||"")};return $(()=>{x()}),(s,e)=>{const v=t("el-avatar"),p=t("el-button"),m=t("el-input"),n=t("el-form-item"),h=t("el-radio"),A=t("el-radio-group"),U=t("el-input-number"),C=t("el-form"),F=t("el-card"),q=t("el-descriptions-item"),D=t("el-descriptions"),M=t("el-dialog");return k(),G(H,null,[i("div",L,[l(F,{class:"profile-card"},{header:a(()=>[...e[12]||(e[12]=[i("div",{class:"profile-header"},[i("span",null,"个人资料")],-1)])]),default:a(()=>[i("div",O,[i("div",Q,[l(v,{size:100,src:s.user.avatar||Y},{default:a(()=>{var r;return[d(R(((r=s.user.username)==null?void 0:r.charAt(0))||"U"),1)]}),_:1},8,["src"]),l(p,{type:"primary",size:"small",class:"avatar-upload-btn"},{default:a(()=>[...e[13]||(e[13]=[d("上传头像",-1)])]),_:1})]),i("div",W,[l(C,{model:o,rules:B,ref_key:"profileFormRef",ref:f,"label-width":"100px"},{default:a(()=>[l(n,{label:"用户名",prop:"username"},{default:a(()=>[l(m,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=r=>o.username=r),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(n,{label:"邮箱",prop:"email"},{default:a(()=>[l(m,{modelValue:o.email,"onUpdate:modelValue":e[1]||(e[1]=r=>o.email=r),placeholder:"请输入邮箱",disabled:""},null,8,["modelValue"])]),_:1}),l(n,{label:"性别",prop:"gender"},{default:a(()=>[l(A,{modelValue:o.gender,"onUpdate:modelValue":e[2]||(e[2]=r=>o.gender=r)},{default:a(()=>[l(h,{label:"male"},{default:a(()=>[...e[14]||(e[14]=[d("男",-1)])]),_:1}),l(h,{label:"female"},{default:a(()=>[...e[15]||(e[15]=[d("女",-1)])]),_:1}),l(h,{label:"other"},{default:a(()=>[...e[16]||(e[16]=[d("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"年龄",prop:"age"},{default:a(()=>[l(U,{modelValue:o.age,"onUpdate:modelValue":e[3]||(e[3]=r=>o.age=r),min:1,max:150,placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1}),l(n,{label:"身高(cm)",prop:"height"},{default:a(()=>[l(U,{modelValue:o.height,"onUpdate:modelValue":e[4]||(e[4]=r=>o.height=r),min:50,max:250,placeholder:"请输入身高"},null,8,["modelValue"])]),_:1}),l(n,{label:"体重(kg)",prop:"weight"},{default:a(()=>[l(U,{modelValue:o.weight,"onUpdate:modelValue":e[5]||(e[5]=r=>o.weight=r),min:10,max:300,placeholder:"请输入体重"},null,8,["modelValue"])]),_:1}),l(n,{label:"健康目标",prop:"healthGoal"},{default:a(()=>[l(m,{modelValue:o.healthGoal,"onUpdate:modelValue":e[6]||(e[6]=r=>o.healthGoal=r),type:"textarea",rows:2,placeholder:"请输入您的健康目标"},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(p,{type:"primary",loading:y.value,onClick:S},{default:a(()=>[...e[17]||(e[17]=[d("保存资料",-1)])]),_:1},8,["loading"]),l(p,{onClick:I},{default:a(()=>[...e[18]||(e[18]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])])]),_:1}),l(F,{class:"security-card"},{header:a(()=>[...e[19]||(e[19]=[i("div",{class:"security-header"},[i("span",null,"账户安全")],-1)])]),default:a(()=>[l(D,{column:1,border:""},{default:a(()=>[l(q,{label:"修改密码"},{default:a(()=>[l(p,{type:"primary",onClick:N},{default:a(()=>[...e[20]||(e[20]=[d("修改密码",-1)])]),_:1})]),_:1}),l(q,{label:"绑定手机"},{default:a(()=>[o.phone?(k(),G("span",X,"已绑定: "+R(o.phone),1)):(k(),J(p,{key:1,type:"primary"},{default:a(()=>[...e[21]||(e[21]=[d("绑定手机",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),l(M,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=r=>w.value=r),title:"修改密码",width:"400px"},{footer:a(()=>[l(p,{onClick:e[10]||(e[10]=r=>w.value=!1)},{default:a(()=>[...e[22]||(e[22]=[d("取消",-1)])]),_:1}),l(p,{type:"primary",loading:P.value,onClick:z},{default:a(()=>[...e[23]||(e[23]=[d("确认修改",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(C,{model:u,rules:E,ref_key:"passwordFormRef",ref:g,"label-width":"100px"},{default:a(()=>[l(n,{label:"当前密码",prop:"currentPassword"},{default:a(()=>[l(m,{modelValue:u.currentPassword,"onUpdate:modelValue":e[7]||(e[7]=r=>u.currentPassword=r),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),l(n,{label:"新密码",prop:"newPassword"},{default:a(()=>[l(m,{modelValue:u.newPassword,"onUpdate:modelValue":e[8]||(e[8]=r=>u.newPassword=r),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),l(n,{label:"确认新密码",prop:"confirmPassword"},{default:a(()=>[l(m,{modelValue:u.confirmPassword,"onUpdate:modelValue":e[9]||(e[9]=r=>u.confirmPassword=r),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});const ae=K(Z,[["__scopeId","data-v-77f25d83"]]);export{ae as default};
